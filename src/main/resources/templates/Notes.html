<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Notes - TeachToTech</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/TT.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Mentor
  * Template URL: https://bootstrapmade.com/mentor-free-education-bootstrap-theme/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
    .page-title {
  height: 200px; /* Adjust height as needed */
  display: flex;
  align-items: flex-start; /* Align content to the top */
  justify-content: center;
  padding-top: 10px; /* Add some spacing if needed */
}

.title-heading {
  margin: 0; /* Remove default margin for better positioning */
  font-size: 20px; /* Adjust font size as needed */
}
body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        background-color: #f4f4f4;
    }

    .form-container {
    width: 80%;
    max-width: 800px;
    background: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 20px;
    margin: 10px auto; /* Centers the form horizontally */
    
}
#category{
  height: 50px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group label {
    font-weight: bold;
}

.form-group input[type="text"],
.form-group textarea { /* Increases size of both input and textarea */
    width: 100%;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 18px; /* Increases text size */
}

.form-group textarea {
    height: 200px; /* Increases the height of the content box */
    resize: vertical; /* Allows users to resize the textarea */
}
.form-group-2 {
    display: flex;
    justify-content: center; /* Centers the button */
    gap: 20px;
}

.form-group-2 button {
    align-self: center;
    padding: 12px 24px;
    background-color: #5fcf80;
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    border-radius: 4px;
}

.form-group button:hover {
    background-color: #4caf6f;
}
.preview-button{
  color:white;
}
.preview-button:active,
.preview-button:focus {
    background-color: #5fcf80;
    color: white;
    outline: none;
}

.sidebar {
    width: 280px;
    background-color: #5fcf80;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    flex-shrink: 0;
    }
    
    .nav-link {
        color: white;
    }
    .sidebar .nav-link {
    border-radius: 4px;
    transition: all 0.3s ease;
}


    
.sidebar .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
    .article-list {
        margin-left: 15px;
    }
    
    .article-list.active {
        display: block; /* Show when active */
    }
    .main-content {
    flex: 1;
    padding: 20px 30px;
    background-color: #f8f9fa;
    overflow-y: auto;
}

.page-title {
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 1px solid #dee2e6;
}

.title-heading {
    font-size: 2rem;
    font-weight: 700;
    color: #212529;
}

.article-content {
    background-color: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    min-height: 300px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .d-flex {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
        max-height: 300px;
    }
    
    .main-content {
        padding: 15px;
    }
}

.hover-highlight:hover {
    color: white !important;
    text-decoration: underline !important;
}
    
    .main {
        margin-left: 20px;
        padding: 20px;
        width: 100%;
    }
    .hover-highlight:hover {
    color: white !important;
    text-decoration: underline !important;
}
.buttons{
    margin-left: 400px;
}

  </style>
  
</head>

<body class="events-page">

    <div th:replace="header2 :: header"></div>
  
    <!-- Sidebar (Discover Articles) -->
    <div class="d-flex"> 
      <!-- Sidebar --> 
      <nav class="sidebar"> 
          <div class="d-flex flex-column w-100 p-3"> 
              <a class="navbar-brand text-white fw-bold mb-3" href="#">Notes</a> 
   
              <!-- Categories will be loaded here via JavaScript --> 
              <ul class="nav flex-column w-100 p-0 m-0" id="categories-container">
                  <!-- This will be populated by JavaScript -->
                  <li class="loading-placeholder text-white">
                      <span><i class="fas fa-spinner fa-spin me-2"></i> Loading categories...</span>
                  </li>
              </ul> 
          </div> 
      </nav> 
   
      <!-- Main Content Area (Expanded) --> 
      <main class="main-content"> 
          <!-- Page Title --> 
          <div class="page-title" data-aos="fade"> 
              <div class="heading"> 
                  <div class="container"> 
                      <div class="row d-flex justify-content-center text-center"> 
                          <div class="col-lg-12"> 
                              <h1 class="title-heading">Select a Topic</h1> 
                          </div> 
                      </div> 
                  </div> 
              </div> 
          </div> 
   
          <!-- Article Content --> 
          <section id="events" class="events section"> 
              <div class="article-content">
                  <div class="text-center text-muted default-content"> 
                      <i class="fas fa-book fa-3x mb-3"></i> 
                      <h3>Click on a topic to view its content</h3> 
                      <p class="lead">Select a category from the sidebar to see available notes</p> 
                  </div>
                  <div class="topic-content" style="display: none;">
                      <!-- This will be populated via JavaScript -->
                  </div>
              </div>
              <div class="d-flex gap-3 mt-4 buttons" style="display: none !important;">
                  <button class="btn btn-warning text-white adminSection">Edit</button> 
                  <button class="btn btn-danger adminSection">Delete</button> 
              </div> 
          </section> 
      </main> 
       
  </div>
  <script>
   document.addEventListener('DOMContentLoaded', function() {
    // Fetch all categories when the page loads
    fetchCategories();

    // Function to fetch all categories
    function fetchCategories() {
        fetch('/category/getallcategory')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(categories => {
                displayCategories(categories);
            })
            .catch(error => {
                console.error('Error fetching categories:', error);
                document.getElementById('categories-container').innerHTML = `
                    <li class="text-white">
                        <span><i class="fas fa-exclamation-circle me-2"></i> Error loading categories</span>
                    </li>`;
            });
    }

    // Function to display categories in the sidebar
    function displayCategories(categories) {
        const categoriesContainer = document.getElementById('categories-container');
        
        if (categories.length === 0) {
            categoriesContainer.innerHTML = `
                <li class="text-white">
                    <span><i class="fas fa-info-circle me-2"></i> No categories found</span>
                </li>`;
            return;
        }

        let categoriesHTML = '';
        
        // Check the structure of your category objects and adjust accordingly
        categories.forEach(category => {
            // Log the category object to inspect its structure
            console.log('Category object:', category);
            
            // Make sure we're using the correct property name for the ID
            // It could be id, categoryId, _id, etc.
            const categoryId = category.id || category.categoryId || category._id;
            
            if (!categoryId) {
                console.error('Category ID is undefined for:', category);
                return;
            }
            
            categoriesHTML += `
                <li class="nav-item category-item">
                    <div class="d-flex align-items-center text-white category-header" data-category-id="${categoryId}">
                        <i class="fas fa-folder me-2"></i>
                        <span>${category.name || category.categoryName || 'Unnamed Category'}</span>
                        <i class="fas fa-chevron-down ms-auto"></i>
                    </div>
                    <ul class="topics-container" id="topics-${categoryId}" style="display: none;">
                        <li class="loading-placeholder text-white ps-4">
                            <span><i class="fas fa-spinner fa-spin me-2"></i> Loading topics...</span>
                        </li>
                    </ul>
                </li>`;
        });
        
        categoriesContainer.innerHTML = categoriesHTML;
        
        // Add event listeners to category headers
        document.querySelectorAll('.category-header').forEach(categoryHeader => {
            categoryHeader.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-category-id');
                
                if (!categoryId) {
                    console.error('Category ID attribute is missing or undefined');
                    return;
                }
                
                const topicsContainer = document.getElementById(`topics-${categoryId}`);
                const chevronIcon = this.querySelector('.fa-chevron-down, .fa-chevron-up');
                
                // Toggle topics visibility
                if (topicsContainer.style.display === 'none') {
                    // Close all other topic containers
                    document.querySelectorAll('.topics-container').forEach(container => {
                        if (container.id !== `topics-${categoryId}`) {
                            container.style.display = 'none';
                            const otherChevron = container.previousElementSibling.querySelector('.fa-chevron-up');
                            if (otherChevron) {
                                otherChevron.classList.replace('fa-chevron-up', 'fa-chevron-down');
                            }
                        }
                    });
                    
                    // Show this topic container
                    topicsContainer.style.display = 'block';
                    chevronIcon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                    
                    // Fetch topics for this category
                    fetchTopics(categoryId);
                } else {
                    // Hide this topic container
                    topicsContainer.style.display = 'none';
                    chevronIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            });
        });
    }

    // Function to fetch topics for a specific category
    function fetchTopics(categoryId) {
        if (!categoryId) {
            console.error('Cannot fetch topics: Category ID is undefined');
            return;
        }
        
        const topicsContainer = document.getElementById(`topics-${categoryId}`);
        
        console.log(`Fetching topics for category ID: ${categoryId}`);
        
        fetch(`/topic/${categoryId}/topics`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(topics => {
                console.log(`Received topics for category ${categoryId}:`, topics);
                displayTopics(categoryId, topics);
            })
            .catch(error => {
                console.error(`Error fetching topics for category ${categoryId}:`, error);
                topicsContainer.innerHTML = `
                    <li class="text-white ps-4">
                        <span><i class="fas fa-exclamation-circle me-2"></i> Error loading topics</span>
                    </li>`;
            });
    }

    // Function to display topics for a category
    function displayTopics(categoryId, topics) {
        const topicsContainer = document.getElementById(`topics-${categoryId}`);
        
        if (!Array.isArray(topics)) {
            console.error('Topics is not an array:', topics);
            topicsContainer.innerHTML = `
                <li class="text-white ps-4">
                    <span><i class="fas fa-exclamation-circle me-2"></i> Invalid topics data</span>
                </li>`;
            return;
        }
        
        if (topics.length === 0) {
            topicsContainer.innerHTML = `
                <li class="text-white ps-4">
                    <span><i class="fas fa-info-circle me-2"></i> No topics found</span>
                </li>`;
            return;
        }

        let topicsHTML = '';
        
        topics.forEach(topic => {
            // Check the structure of your topic objects and adjust accordingly
            console.log('Topic object:', topic);
            
            // Make sure we're using the correct property name for the ID and title
            const topicId = topic.id || topic.topicId || topic._id;
            const topicTitle = topic.title || topic.name || 'Unnamed Topic';
            
            if (!topicId) {
                console.error('Topic ID is undefined for:', topic);
                return;
            }
            
            topicsHTML += `
                <li class="nav-item topic-item ps-4">
                    <div class="d-flex align-items-center text-white topic-header" data-topic-id="${topicId}">
                        <i class="fas fa-file-alt me-2"></i>
                        <span>${topicTitle}</span>
                    </div>
                </li>`;
        });
        
        topicsContainer.innerHTML = topicsHTML;
        
        // Add event listeners to topic headers
        topicsContainer.querySelectorAll('.topic-header').forEach(topicHeader => {
            topicHeader.addEventListener('click', function() {
                const topicId = this.getAttribute('data-topic-id');
                
                if (!topicId) {
                    console.error('Topic ID attribute is missing or undefined');
                    return;
                }
                
                // Highlight the selected topic
                document.querySelectorAll('.topic-header').forEach(header => {
                    header.classList.remove('active-topic');
                });
                this.classList.add('active-topic');
                
                // Fetch topic content
                fetchTopicContent(topicId);
            });
        });
    }

    // Function to fetch content for a specific topic
    function fetchTopicContent(topicId) {
        if (!topicId) {
            console.error('Cannot fetch topic content: Topic ID is undefined');
            return;
        }
        
        const defaultContent = document.querySelector('.default-content');
        const topicContent = document.querySelector('.topic-content');
        const buttons = document.querySelector('.buttons');
        
        // Show loading state
        topicContent.innerHTML = `
            <div class="text-center">
                <i class="fas fa-spinner fa-spin fa-3x mb-3"></i>
                <p>Loading content...</p>
            </div>`;
        defaultContent.style.display = 'none';
        topicContent.style.display = 'block';
        
        console.log(`Fetching content for topic ID: ${topicId}`);
        
        fetch(`/topic/${topicId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(topic => {
                console.log(`Received content for topic ${topicId}:`, topic);
                displayTopicContent(topic);
                
                // Show admin buttons
                if (buttons) {
                    buttons.style.display = 'flex';
                    // Remove !important from inline style and add a class instead
                    buttons.classList.add('d-flex');
                }
            })
            .catch(error => {
                console.error(`Error fetching content for topic ${topicId}:`, error);
                topicContent.innerHTML = `
                    <div class="text-center text-danger">
                        <i class="fas fa-exclamation-circle fa-3x mb-3"></i>
                        <h3>Error loading content</h3>
                        <p>Could not load the requested topic content. Please try again later.</p>
                    </div>`;
            });
    }

    // Function to display topic content
    function displayTopicContent(topic) {
        if (!topic) {
            console.error('Topic object is undefined or null');
            return;
        }
        
        const topicContent = document.querySelector('.topic-content');
        const titleHeading = document.querySelector('.title-heading');
        
        // Make sure we're using the correct property names
        const title = topic.title || topic.name || 'Unnamed Topic';
        const content = topic.content || topic.body || topic.text || 'No content available';
        const createdAt = topic.createdAt || topic.created || topic.date || new Date().toISOString();
        const updatedAt = topic.updatedAt || topic.updated || topic.lastModified;
        
        // Update page title
        if (titleHeading) {
            titleHeading.textContent = title;
        }
        
        // Display topic content
        topicContent.innerHTML = `
            <h2>${title}</h2>
            <div class="topic-metadata">
                <span class="text-muted"><i class="fas fa-calendar-alt me-2"></i>${formatDate(createdAt)}</span>
                ${updatedAt ? `<span class="text-muted ms-3"><i class="fas fa-edit me-2"></i>Updated: ${formatDate(updatedAt)}</span>` : ''}
            </div>
            <hr>
            <div class="topic-body">
                ${content}
            </div>`;
    }

    // Helper function to format dates
    function formatDate(dateString) {
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
                return 'Invalid date';
            }
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        } catch (error) {
            console.error('Error formatting date:', error);
            return 'Unknown date';
        }
    }
});
  </script>
  


  <!-- Main Content (Shifted Right) -->
  

  <div th:replace="footer :: footer"></div>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->

    
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Font Awesome (for icons) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

</body>
</html>

